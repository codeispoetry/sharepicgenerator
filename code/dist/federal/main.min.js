function reset(){}function showLayout(){$("[data-layout]").toggleClass("btn-info"),$("[data-layout]").toggleClass("btn-outline-info"),$(".noquote").toggleClass("d-none"),config.layout=$("[data-layout].btn-info").data("layout"),quote.draw(),text.draw()}$(document).ready(function(){$("#text").val("[Leben]\nlassen")});const text={svg:draw.text(""),colors:["#ffffff","#ffee00"],lineheight:20,linemargin:-4,paddingLr:5,font:{anchor:"left",leading:"1.0em",size:20},fontoutsidelines:{family:"ArvoGruen",size:10,anchor:"left",leading:"1.0em"},draw:function(){if(void 0!==config.layout&&"standard"!==config.layout)return;if(text.svg.remove(),""==$("#text").val())return;text.svg=draw.group().addClass("draggable").attr("id","svg-text").draggable(),text.svg.on("dragend.namespace",function(t){$("#textX").val(Math.round(this.x())),$("#textY").val(Math.round(this.y())),text.bounce()});let t,e=0,i=$("#text").val().replace(/\n$/,"").split(/\n/),o=i.length<=3?"ArvoGruen":"Arvo",n=16*i.reduce(function(t,e){return t.length>e.length?t:e}).length,s=[],a=[];i.forEach(function(t,r,l){let g=1;i.length<4&&(t=t.toUpperCase()),values=t.split(/\[|\]/);let d=draw.text(function(t){for(let e=0;e<values.length;e++)g=0==g?1:0,t.tspan(values[e]).fill(text.colors[g]).font(Object.assign(text.font,{family:o})),t.attr("xml:space","preserve"),t.attr("style","white-space:pre")});d.move(0,e),$("#textsamesize").prop("checked")&&(d=draw.group().add(d).size(n)),e+=d.rbox().h+text.linemargin,s[r]=e,a[r]=d,text.svg.add(d)});let r=Math.min(i.length,parseInt($("#iconsize").val()));if(icon.isLoaded){(t=icon.svg.clone()).move(0,3).size(null,s[r-1]-3),text.svg.add(t);for(let e=0;e<r;e++)a[e].dx(1.15*t.width())}let l=draw.rect(text.svg.width(),2).fill("#ffffff").dy(-4),g=l.clone().dy(text.svg.height()+6);text.svg.add(l),text.svg.add(g);let d=$("#textbefore").val().split(/\[|\]/),h=1,c=draw.text(function(t){for(let e=0;e<d.length;e++)h=0==h?1:0,t.tspan(d[e]).fill(text.colors[h]).font(text.fontoutsidelines),t.attr("xml:space","preserve"),t.attr("style","white-space:pre")});c.dy(-7);let f=$("#textafter").val().split(/\[|\]/);h=1;let v=draw.text(function(t){for(let e=0;e<f.length;e++)h=0==h?1:0,t.tspan(f[e]).fill(text.colors[h]).font(text.fontoutsidelines),t.attr("xml:space","preserve"),t.attr("style","white-space:pre")});if(v.dy(text.svg.height()+7),text.svg.add(c),text.svg.add(v),$("#greenbehindtext").prop("checked")){let t=10,e=draw.rect(text.svg.width()+2*t,text.svg.height()+2*t).fill("#46962b").move(-t,-14).back();$("#textbefore").val()&&e.dy(-9),$("#textbefore").val()&&$("#textafter").val()&&e.height(e.height()-6),text.svg.add(e),e.back()}text.svg.move(parseInt($("#textX").val()),parseInt($("#textY").val())).size(parseInt($("#textsize").val()))},bounce:function(){this.svg.x()<15&&($("#textX").val(15),this.draw()),this.svg.x()>draw.width()-this.svg.width()-15&&($("#textX").val(draw.width()-this.svg.width()-15),this.draw()),this.svg.y()<30&&($("#textY").val(30),this.draw()),this.svg.y()>draw.height()-this.svg.height()-30&&($("#textY").val(draw.height()-this.svg.height()-30),this.draw())}};$("#text, #textbefore, #textafter, #textsize, #textsamesize, #greenbehindtext").bind("input propertychange",text.draw);const bigright={svg:draw.text(""),fond:draw.rect(),colors:["#ffffff","#ffee00"],fontsizes:[20,20],lineheights:[20,20],yBiases:[0,0],linemargin:0,paddingLr:5,font:{family:"Arvo",anchor:"left",leading:"1.0em"},fontoutsidelines:{family:"Arvo",size:6,anchor:"left",leading:"1.0em",weight:300},draw:function(){if("bigright"!=$("#design").val())return;bigright.svg.remove(),bigright.svg=draw.group(),bigright.fond.remove(),bigright.fond=draw.rect(draw.width()/2,draw.height()).dx(draw.width()/2).fill("#46962b");let t=0,e=$("#text").val().split(/\n/),i=e.length<=3?700:300;e.forEach(function(e,o,n){let s=/^!/.test(e)?1:0;e=e.replace(/^!/,"").toUpperCase();let a=draw.text(e).font(Object.assign(bigright.font,{weight:i,size:bigright.fontsizes[s]})).fill(bigright.colors[s]).move(0,t+bigright.yBiases[s]);bigright.svg.add(a),t+=bigright.lineheights[s]+bigright.linemargin});let o=draw.rect(bigright.svg.width(),2).fill("#ffffff").dy(-4),n=o.clone().dy(bigright.svg.height()+6);bigright.svg.add(o),bigright.svg.add(n);let s=draw.text($("#textbefore").val()).font(bigright.fontoutsidelines).fill("#ffffff").dy(-14),a=draw.text($("#textafter").val()).font(bigright.fontoutsidelines).fill("#ffffff").dy(bigright.svg.height()-2);bigright.svg.add(s),bigright.svg.add(a),bigright.svg.size(.4*draw.width()).move(.55*draw.width(),(draw.height()-bigright.svg.height())/2).front()}};$("#text, #textbefore, #textafter").bind("input propertychange",bigright.draw);const quote={svg:draw.text(""),colors:["#ffffff","#ffee00"],lineheight:20,linemargin:-4,paddingLr:5,font:{anchor:"middle",leading:"1.0em",size:20},fontoutsidelines:{family:"Arvo",size:10,anchor:"middle",leading:"1.0em"},draw:function(){if("quote"!==config.layout)return;if(text.svg.remove(),""==$("#text").val())return;text.svg=draw.group().addClass("draggable").attr("id","svg-text").draggable(),text.svg.on("dragend.namespace",function(t){$("#textX").val(Math.round(this.x())),$("#textY").val(Math.round(this.y())),text.bounce()});let t=0,e=[],i=[];("„"+$("#text").val()+"“").replace(/\n$/,"").split(/\n/).forEach(function(o,n,s){let a=1;values=o.split(/\[|\]/);let r=draw.text(function(t){for(let e=0;e<values.length;e++)a=0==a?1:0,t.tspan(values[e]).fill(quote.colors[a]).font(Object.assign(quote.font,{family:"Arvo"})),t.attr("xml:space","preserve"),t.attr("style","white-space:pre")});r.y(t),t+=r.rbox().h+quote.linemargin,e[n]=t,i[n]=r,text.svg.add(r)});let o=.5*text.svg.width(),n=(text.svg.width()-o)/2,s=draw.rect(o,1).fill("#ffffff").dx(-1*n).dy(text.svg.height()+4);text.svg.add(s);let a=$("#textafter").val().toUpperCase().split(/\[|\]/);style=1;let r=draw.text(function(t){for(let e=0;e<a.length;e++)style=0==style?1:0,t.tspan(a[e]).fill(quote.colors[style]).font(quote.fontoutsidelines),t.attr("xml:space","preserve"),t.attr("style","white-space:pre")});r.dy(text.svg.height()+12),text.svg.add(r),text.svg.move(parseInt($("#textX").val()),parseInt($("#textY").val())).size(parseInt($("#textsize").val()))},bounce:function(){this.svg.x()<15&&($("#textX").val(15),this.draw()),this.svg.x()>draw.width()-this.svg.width()-15&&($("#textX").val(draw.width()-this.svg.width()-15),this.draw()),this.svg.y()<30&&($("#textY").val(30),this.draw()),this.svg.y()>draw.height()-this.svg.height()-30&&($("#textY").val(draw.height()-this.svg.height()-30),this.draw())}};$("#text, #textafter, #textsize").bind("input propertychange",quote.draw);const logo={isLoaded:!1,config:{sonnenblume:{file:"../assets/logos/sonnenblume.svg",widthFraction:.1,position:"topright"},"sonnenblume-weiss":{file:"../assets/logos/sonnenblume-weiss.svg",widthFraction:.1,position:"topright"},"logo-weiss":{file:"../assets/logos/logo-weiss.svg",widthFraction:.2,position:"topright"},"logo-gruen":{file:"../assets/logos/logo-gruen.svg",widthFraction:.2,position:"topright"},"sonnenblume-big":{file:"../assets/logos/sonnenblume.svg",widthFraction:.5,position:"bottomleftOutside"},"logo-berlin-weiss":{file:"../assets/logos/berlin-weiss.svg",widthFraction:.2,position:"topright"},"logo-berlin-gruen":{file:"../assets/logos/berlin-gruen.svg",widthFraction:.2,position:"topright"},custom:{file:"../persistent/user/"+config.user+"/logo.png",widthFraction:.2,position:"topright"}},load(){if(whichLogo=$("#logoselect").val(),logo.svg&&logo.svg.remove(),logo.isLoaded=!1,"void"==whichLogo)return!1;this.logoinfo=this.config[whichLogo],this.svg=draw.image(this.logoinfo.file,function(t){logo.isLoaded=!0,logo.draw()})},draw(){if(!logo.isLoaded)return!1;let t,e,i=Math.max(50,draw.width()*logo.logoinfo.widthFraction);switch(logo.svg.size(i),logo.logoinfo.position){case"bottomleft":t=10,e=draw.height()-logo.svg.height()-10-20;break;case"bottomleftOutside":t=-.5*i+20,e=-20+draw.height()-.5*logo.svg.height();break;default:t=draw.width()-i-10,e=10}logo.svg.move(t,e)}};logo.load(),$("#logoselect").on("change",function(){if("custom"!=$(this).val()){if("deletecustomlogo"==$(this).val()){if(!confirm("Eigenes Logo wirklich dauerhaft löschen?"))return;return $("#logoselect").val($("#logoselect option:first").val()),$.post("../delete.php",{user:config.user,accesstoken:config.accesstoken}).done(function(t){if(JSON.parse(t).error)return!1}),void logo.load()}logo.load()}else $("#uploadlogo").click()}),$("#pinsize").bind("input propertychange",function(){pin.draw()}),$(".pinreset").click(function(){$("#pinY").val(draw.height()/2),pin.draw()});const pinfont={family:"Arvo",size:15,anchor:"left",weight:300},pin={isLoaded:!1,svg:draw.text(""),draw(){$("#eyecatchersize").prop("disabled",0==$("#pintext").val().length);let t=($("#pintext").val().match(/\n/g)||[]).length;if(t>1&&$("#pintext").val($("#pintext").val().replace(/\n.*$/,"")),pin.svg.remove(),pin.svg=draw.group(),""==$("#pintext").val())return;pin.svg.addClass("draggable").draggable(),pin.svg.on("dragstart.namespace",t=>{pin.svg.rotate(9,draw.width(),pin.svg.y())}),pin.svg.on("dragmove.namespace",t=>{const{handler:e,box:i}=t.detail;t.preventDefault();let{x:o,y:n}=i;e.move(draw.width()-pin.svg.width(),n)}),pin.svg.on("dragend.namespace",t=>{pin.svg.rotate(-9,draw.width(),pin.svg.y()),$("#pinX").val(Math.round(pin.svg.x())),$("#pinY").val(Math.round(pin.svg.y()))});let e=draw.text($("#pintext").val()).font(pinfont).fill("#ffffff"),i=e.rbox().w+40+20*t,o=e.rbox().h+20,n=draw.polygon([[0,0],[i,0],[i,o],[0,o],[o/2,o/2]]).fill("#e6007e");e.move(28+10*t,9),e.attr("xml:space","preserve").attr("style","white-space:pre"),pin.svg.add(n),pin.svg.add(e),pin.svg.move(draw.width()-pin.svg.width(),$("#pinY").val());let s=$("#eyecatchersize").val()/100;pin.svg.scale(s,s,draw.width(),$("#pinY").val()),pin.svg.rotate(-9,draw.width(),pin.svg.y()),pin.svg.front()},bounce:function(){}};$("#pintext, #eyecatchersize").bind("input propertychange",pin.draw);const icon={isLoaded:!1,load(){this.svg&&this.svg.remove(),icon.isLoaded=!1;let t=$("#iconfile").val();this.svg=draw.image(t,function(t){icon.isLoaded=!0,icon.svg.size(1).move(-100,-100),text.draw(),$(".iconsizeselectwrapper").removeClass("d-none")}),this.svg.on("error",function(e){console.log(t,e)})},remove(){this.svg&&this.svg.remove(),this.isLoaded=!1}};function getIcons(t){let e="nounproject/load_results.php?q="+t;$("#iconoverlay .results").html("suche Icons ");let i=window.setInterval(function(){$("#iconoverlay .results").append(" . ")},10);$.ajax({url:e,success:function(t,e,o){$("#iconoverlay .results").html("");let n=JSON.parse(t);n.hits.forEach(function(t){$("#iconoverlay .results").append('<div class="chooseicon" data-icon-url="'+t.icon_url+'"  data-attribution="'+t.attribution+'"><img src="'+t.preview_url+'" title="'+t.attribution+'"/></div>')}),0==n.hits.length&&$("#iconoverlay .results").append('<div class="col-12 bg-danger text-white p-3 text-center">Keine Icons gefunden. Bitte suche auf Englisch.</div>'),$("#iconoverlay .results .chooseicon").click(function(){$("#waiting").addClass("active"),$("#iconoverlay").removeClass("active");let t=$(this).data("attribution");$.get("nounproject/get_icon.php",{icon_url:$(this).data("icon-url")}).done(function(e){"error"==e?console.log("error downloading icon"):($("#iconfile").val("tmp/"+e),icon.load(),setCopyright(t,"nounproject")),closeOverlay()})}),window.clearInterval(i)},error:function(t,e,i){console.log(t,i)}})}$("#iconsize").on("change",function(){0==$(this).val()&&icon.remove(),text.draw()}),$("#iconopener").click(function(){$('head meta[name="viewport"]').attr("content","width=device-width, initial-scale=1"),$("#iconoverlay").addClass("active")}),$("#iconoverlay form").submit(function(){return getIcons($("#iconoverlay .q").val()),!1});