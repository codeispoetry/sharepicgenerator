const text={svg:draw.text(""),colors:["#ffffff","#ffee00"],lineheight:20,linemargin:-4,paddingLr:5,font:{anchor:"left",leading:"1.0em",size:20},fontoutsidelines:{family:"ArvoGruen",size:10,anchor:"left",leading:"1.0em"},draw:function(){if(text.svg.remove(),""==$("#text").val())return;text.svg=draw.group().addClass("draggable").attr("id","svg-text").draggable(),text.svg.on("dragend.namespace",function(t){$("#textX").val(Math.round(this.x())),$("#textY").val(Math.round(this.y())),text.bounce()});let t,e=0,i=$("#text").val().replace(/\n$/,"").split(/\n/),n=i.length<=3?"ArvoGruen":"Arvo",a=16*i.reduce(function(t,e){return t.length>e.length?t:e}).length,r=[],s=[];i.forEach(function(t,o,l){let g=1;i.length<4&&(t=t.toUpperCase()),values=t.split(/\[|\]/);let d=draw.text(function(t){for(let e=0;e<values.length;e++)g=0==g?1:0,t.tspan(values[e]).fill(text.colors[g]).font(Object.assign(text.font,{family:n})),t.attr("xml:space","preserve"),t.attr("style","white-space:pre")});d.move(0,e),$("#textsamesize").prop("checked")&&(d=draw.group().add(d).size(a)),e+=d.rbox().h+text.linemargin,r[o]=e,s[o]=d,text.svg.add(d)});let o=Math.min(i.length,parseInt($("#iconsize").val()));if(icon.isLoaded){(t=icon.svg.clone()).move(0,3).size(null,r[o-1]-3),text.svg.add(t);for(let e=0;e<o;e++)s[e].dx(1.15*t.width())}let l=draw.rect(text.svg.width(),2).fill("#ffffff").dy(-4),g=l.clone().dy(text.svg.height()+6);text.svg.add(l),text.svg.add(g);let d=$("#textbefore").val().split(/\[|\]/),h=1,v=draw.text(function(t){for(let e=0;e<d.length;e++)h=0==h?1:0,t.tspan(d[e]).fill(text.colors[h]).font(text.fontoutsidelines),t.attr("xml:space","preserve"),t.attr("style","white-space:pre")});v.dy(-7);let c=$("#textafter").val().split(/\[|\]/);h=1;let f=draw.text(function(t){for(let e=0;e<c.length;e++)h=0==h?1:0,t.tspan(c[e]).fill(text.colors[h]).font(text.fontoutsidelines),t.attr("xml:space","preserve"),t.attr("style","white-space:pre")});if(f.dy(text.svg.height()+7),text.svg.add(v),text.svg.add(f),$("#greenbehindtext").prop("checked")){let t=10,e=draw.rect(text.svg.width()+2*t,text.svg.height()+2*t).fill("#46962b").move(-t,-14).back();$("#textbefore").val()&&e.dy(-9),$("#textbefore").val()&&$("#textafter").val()&&e.height(e.height()-6),text.svg.add(e),e.back()}text.svg.move(parseInt($("#textX").val()),parseInt($("#textY").val())).size(parseInt($("#textsize").val()))},bounce:function(){this.svg.x()<15&&($("#textX").val(15),this.draw()),this.svg.x()>draw.width()-this.svg.width()-15&&($("#textX").val(draw.width()-this.svg.width()-15),this.draw()),this.svg.y()<30&&($("#textY").val(30),this.draw()),this.svg.y()>draw.height()-this.svg.height()-30&&($("#textY").val(draw.height()-this.svg.height()-30),this.draw())}};$("#text, #textbefore, #textafter, #textsize, #textsamesize, #greenbehindtext").bind("input propertychange",text.draw);const bigright={svg:draw.text(""),fond:draw.rect(),colors:["#ffffff","#ffee00"],fontsizes:[20,20],lineheights:[20,20],yBiases:[0,0],linemargin:0,paddingLr:5,font:{family:"Arvo",anchor:"left",leading:"1.0em"},fontoutsidelines:{family:"Arvo",size:6,anchor:"left",leading:"1.0em",weight:300},draw:function(){if("bigright"!=$("#design").val())return;bigright.svg.remove(),bigright.svg=draw.group(),bigright.fond.remove(),bigright.fond=draw.rect(draw.width()/2,draw.height()).dx(draw.width()/2).fill("#46962b");let t=0,e=$("#text").val().split(/\n/),i=e.length<=3?700:300;e.forEach(function(e,n,a){let r=/^!/.test(e)?1:0;e=e.replace(/^!/,"").toUpperCase();let s=draw.text(e).font(Object.assign(bigright.font,{weight:i,size:bigright.fontsizes[r]})).fill(bigright.colors[r]).move(0,t+bigright.yBiases[r]);bigright.svg.add(s),t+=bigright.lineheights[r]+bigright.linemargin});let n=draw.rect(bigright.svg.width(),2).fill("#ffffff").dy(-4),a=n.clone().dy(bigright.svg.height()+6);bigright.svg.add(n),bigright.svg.add(a);let r=draw.text($("#textbefore").val()).font(bigright.fontoutsidelines).fill("#ffffff").dy(-14),s=draw.text($("#textafter").val()).font(bigright.fontoutsidelines).fill("#ffffff").dy(bigright.svg.height()-2);bigright.svg.add(r),bigright.svg.add(s),bigright.svg.size(.4*draw.width()).move(.55*draw.width(),(draw.height()-bigright.svg.height())/2).front()}};$("#text, #textbefore, #textafter").bind("input propertychange",bigright.draw),$("#pinsize").bind("input propertychange",function(){pin.draw()}),$(".pinreset").click(function(){$("#pinY").val(draw.height()/2),pin.draw()});const pinfont={family:"Arvo",size:15,anchor:"left",weight:300},pin={isLoaded:!1,svg:draw.text(""),draw(){$("#eyecatchersize").prop("disabled",0==$("#pintext").val().length);let t=($("#pintext").val().match(/\n/g)||[]).length;if(t>1&&$("#pintext").val($("#pintext").val().replace(/\n.*$/,"")),pin.svg.remove(),pin.svg=draw.group(),""==$("#pintext").val())return;pin.svg.addClass("draggable").draggable(),pin.svg.on("dragstart.namespace",t=>{pin.svg.rotate(9,draw.width(),pin.svg.y())}),pin.svg.on("dragmove.namespace",t=>{const{handler:e,box:i}=t.detail;t.preventDefault();let{x:n,y:a}=i;e.move(draw.width()-pin.svg.width(),a)}),pin.svg.on("dragend.namespace",t=>{pin.svg.rotate(-9,draw.width(),pin.svg.y()),$("#pinX").val(Math.round(pin.svg.x())),$("#pinY").val(Math.round(pin.svg.y()))});let e=draw.text($("#pintext").val()).font(pinfont).fill("#ffffff"),i=e.rbox().w+40+20*t,n=e.rbox().h+20,a=draw.polygon([[0,0],[i,0],[i,n],[0,n],[n/2,n/2]]).fill("#e6007e");e.move(28+10*t,9),e.attr("xml:space","preserve").attr("style","white-space:pre"),pin.svg.add(a),pin.svg.add(e),pin.svg.move(draw.width()-pin.svg.width(),$("#pinY").val());let r=$("#eyecatchersize").val()/100;pin.svg.scale(r,r,draw.width(),$("#pinY").val()),pin.svg.rotate(-9,draw.width(),pin.svg.y()),pin.svg.front()},bounce:function(){}};$("#pintext, #eyecatchersize").bind("input propertychange",pin.draw);const icon={isLoaded:!1,load(){this.svg&&this.svg.remove(),icon.isLoaded=!1;let t=$("#iconfile").val();this.svg=draw.image(t,function(t){icon.isLoaded=!0,icon.svg.size(1).move(-100,-100),text.draw(),$(".iconsizeselectwrapper").removeClass("d-none")}),this.svg.on("error",function(e){console.log(t,e)})},remove(){this.svg&&this.svg.remove(),this.isLoaded=!1}};function getIcons(t){let e="nounproject/load_results.php?q="+t;$("#iconoverlay .results").html("suche Icons ");let i=window.setInterval(function(){$("#iconoverlay .results").append(" . ")},10);$.ajax({url:e,success:function(t,e,n){$("#iconoverlay .results").html("");let a=JSON.parse(t);a.hits.forEach(function(t){$("#iconoverlay .results").append('<div class="chooseicon" data-icon-url="'+t.icon_url+'"  data-attribution="'+t.attribution+'"><img src="'+t.preview_url+'" title="'+t.attribution+'"/></div>')}),0==a.hits.length&&$("#iconoverlay .results").append('<div class="col-12 bg-danger text-white p-3 text-center">Keine Icons gefunden. Bitte suche auf Englisch.</div>'),$("#iconoverlay .results .chooseicon").click(function(){$("#waiting").addClass("active"),$("#iconoverlay").removeClass("active");let t=$(this).data("attribution");$.get("nounproject/get_icon.php",{icon_url:$(this).data("icon-url")}).done(function(e){"error"==e?console.log("error downloading icon"):($("#iconfile").val("tmp/"+e),icon.load(),setCopyright(t,"nounproject")),closeOverlay()})}),window.clearInterval(i)},error:function(t,e,i){console.log(t,i)}})}$("#iconsize").on("change",function(){0==$(this).val()&&icon.remove(),text.draw()}),$("#iconopener").click(function(){$('head meta[name="viewport"]').attr("content","width=device-width, initial-scale=1"),$("#iconoverlay").addClass("active")}),$("#iconoverlay form").submit(function(){return getIcons($("#iconoverlay .q").val()),!1});